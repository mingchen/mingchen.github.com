
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Ming's Blog</title>
  <meta name="author" content="Ming">

  
  <meta name="description" content="什么是virtualenv virtualenv is a tool to create isolated Python environments.The basic problem being addressed is one of dependencies and versions, and &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.chenming.info/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Ming's Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-33056683-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Ming's Blog</a></h1>
  
    <h2>trivial notes</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.chenming.info" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/blog/categories">Categories</a></li>
  <li><a href="/blog/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/08/python-pip-virtualenv/">Python的virtualenv和pip</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-08T22:53:00+08:00" pubdate data-updated="true">Jul 8<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/07/08/python-pip-virtualenv/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>什么是virtualenv</h2>

<blockquote><p>virtualenv is a tool to create isolated Python environments.</p><p>The basic problem being addressed is one of dependencies and versions, and indirectly permissions. Imagine you have an application that needs version 1 of LibFoo, but another application requires version 2. How can you use both these applications? If you install everything into /usr/lib/python2.7/site-packages (or whatever your platform’s standard location is), it’s easy to end up in a situation where you unintentionally upgrade an application that shouldn’t be upgraded.</p><p>Or more generally, what if you want to install an application and leave it be? If an application works, any change in its libraries or the versions of those libraries can break the application.</p><p>Also, what if you can’t install packages into the global site-packages directory? For instance, on a shared host.</p><p>In all these cases, virtualenv can help you. It creates an environment that has its own installation directories, that doesn’t share libraries with other virtualenv environments (and optionally doesn’t access the globally installed libraries either).</p><footer><strong>What It Does</strong> <cite><a href='http://www.virtualenv.org/en/latest/index.html#id4'>www.virtualenv.org/en/latest/&hellip;</a></cite></footer></blockquote>


<h2>安装virtualenv和pip</h2>

<p>推荐的安装方法是安装<code>virtualenv</code>，它会自动安装<code>pip</code>。
最简单安装<code>virtualenv</code>的方法如下：</p>

<pre><code>$ curl -O https://raw.github.com/pypa/virtualenv/master/virtualenv.py
$ python virtualenv.py my_new_env
$ . my_new_env/bin/activate
(my_new_env)$ pip install ...
</code></pre>

<p>安装<code>pip</code>的前提条件是要安装<a href="http://pypi.python.org/pypi/setuptools">setuptools</a>
或<a href="http://pypi.python.org/pypi/distribute">distribute</a>。
安装<code>distribute</code>的方法：</p>

<pre><code>$ curl http://python-distribute.org/distribute_setup.py | python
</code></pre>

<p><em>警告</em>：如果是<code>Python 3.x</code>，必须安装<code>distribute</code>，因为<code>setuptools</code>不支持<code>Python 3.x</code>。</p>

<p>如果不想安装<code>virtualenv</code>，也可以直接安装<code>pip</code>：</p>

<pre><code>$ curl https://raw.github.com/pypa/pip/master/contrib/get-pip.py | python
</code></pre>

<p>这可能需要<code>root</code>的权限。</p>

<h3>pip用法</h3>

<p><code>pip</code>是个包管理系统，使用它能方便的安装我们想要的包。</p>

<h4>安装</h4>

<p>使用<code>pip</code>的<code>install</code>命令即可安装一个指定的软件包：</p>

<pre><code>$ pip install SomePackage
</code></pre>

<p>如果已经安装了某个软件包，需要升级安装，需要指定<code>--upgrade</code>参数：</p>

<pre><code>$ pip install --upgrade SomePackage
</code></pre>

<p>如果要安装指定的版本的软件包，直接指定软件包版本即可：</p>

<pre><code>$ pip install SomePackage==1.0.4
</code></pre>

<p><code>pip</code>还指定安装包的路径，包括从本地源代码安装或者网上的某个链接安装：</p>

<pre><code>$ pip install ./downloads/SomePackage-1.0.4.tar.gz
$ pip install http://my.package.repo/SomePackage-1.0.4.zip
</code></pre>

<h4>卸载</h4>

<p>要卸载一个软件包，使用<code>uninstall</code>命令即可：</p>

<pre><code>$ pip uninstall package-name
</code></pre>

<h4>查询</h4>

<p>如果不清楚要安装的软件包的具体名称，可以使用<code>search</code>命令进行查询：</p>

<pre><code>$ pip search "query"
</code></pre>

<p>它会列出所有相关的软包。</p>

<h2>参考</h2>

<ul>
<li><a href="http://pypi.python.org/pypi/pip/">http://pypi.python.org/pypi/pip/</a></li>
<li><a href="http://www.virtualenv.org">http://www.virtualenv.org</a></li>
<li><a href="http://www.pip-installer.org/">http://www.pip-installer.org/</a></li>
<li><a href="http://www.pip-installer.org/en/latest/usage.html">http://www.pip-installer.org/en/latest/usage.html</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/04/android-sparsearray/">Android上使用SparseArray来替代HashMap</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-04T10:50:00+08:00" pubdate data-updated="true">Jul 4<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/07/04/android-sparsearray/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>在android上做lint时，下面的代码会收到警告，提示使用<code>SparseArray</code>来代替<code>HashMap</code>来提高性能。</p>

<pre><code>private static Map&lt;Integer, CommandHandler&gt; mCmdToComponent
    = new HashMap&lt;Integer, CommandHandler&gt;();
</code></pre>

<p>详细信息如下：</p>

<blockquote><p>Use new SparseArray&lt;Object&gt;(&#8230;) instead for better performance</p><p>Issue: Looks for opportunities to replace HashMaps with the more efficient SparseArray<br/>Id: UseSparseArrays</p><p>For maps where the keys are of type integer, it&#8217;s typically more efficient to use the Android SparseArray API. This check identifies scenarios where you might want to consider using SparseArray instead of HashMap for better performance.</p><p>This is *particularly* useful when the value types are primitives like ints, where you can use SparseIntArray and avoid auto-boxing the values from int to Integer.</p><p>If you need to construct a HashMap because you need to call an API outside of your control which requires a Map, you can suppress this warning using for example the @SuppressLint annotation.</p></blockquote>


<p>出于好奇看了看<code>SparseArray</code>的源代码，发现它内部是使用有序数组+二分查找来实现的。
插入、查找和删除操作的效率都是<code>log2(n)</code>。
在插入的时候还要对整个数组进行移动，代价也是不低的。
对<code>HashMap</code>来说，它更省空间和省了<code>auto-boxing</code>的开销。</p>

<p>参考:</p>

<ul>
<li><a href="http://developer.android.com/reference/android/util/SparseArray.html">http://developer.android.com/reference/android/util/SparseArray.html</a></li>
<li><a href="http://grepcode.com/file/repository.grepcode.com/java/ext/com.google.android/android/4.0.3_r1/android/util/SparseArray.java?av=f">SparseArray.java - 源代码</a></li>
<li><a href="http://code.google.com/p/re2/source/browse/util/sparse_array.h">http://code.google.com/p/re2/source/browse/util/sparse_array.h</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/06/29/install-octave-on-mac/">在Mac上安装octave</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-06-29T21:02:00+08:00" pubdate data-updated="true">Jun 29<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/06/29/install-octave-on-mac/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://www.gnu.org/software/octave/">octave</a>
是类似<code>matlab</code>的用于科学计算（比如矩阵的算法）的免费工具。
用<code>matlab</code>写的代码很多都直接能直接在<code>octave</code>下运行。
它能工作在Windows，Linux，MacOS下。</p>

<blockquote><p>GNU Octave is a high-level interpreted language,<br/>primarily intended for numerical computations.<br/>It provides capabilities for the numerical solution<br/>of linear and nonlinear problems, and for performing<br/>other numerical experiments.<br/>It also provides extensive graphics capabilities for<br/>data visualization and manipulation.</p></blockquote>


<p>本以为<code>brew install octave</code>就能安装的，但是发现没有这么简单。
为了在MacOS下能正常使用<code>octave</code>，还颇费一番周折。</p>

<h2>我的环境</h2>

<p>我的OS和编译器版本如下：</p>

<pre><code>Mac OS X 10.7.4
Xcode 4.3.2
</code></pre>

<h2>安装过程</h2>

<h3>安装fortan编译器</h3>

<p>预先需要安装一个gfortan的编译器：</p>

<pre><code>brew install gfortran
</code></pre>

<h3>安装fltk</h3>

<p>由于某些组建使用了fltk，而<code>brew</code>里面的<code>fltk</code>版本不对，无法安装。
需要手动安装<code>fltk</code>。从<a href="http://www.fltk.org/">http://www.fltk.org/</a>下载fltk-1.3.0后并解压缩，
然后执行如下命令安装：</p>

<pre><code>./configure --disable-debug --enable-shared --prefix=/usr/local/Cellar/fltk/1.3.0
make install
brew link fltk
</code></pre>

<h3>安装aquaterm</h3>

<p><code>octave</code>依赖<code>gnuplot</code>来绘图，并使用了<code>aqua term</code>。
如果没有<code>aqua term</code>，会导致<code>octave</code>无法画图。
因此需要先安装<code>aquaterm</code>，可以在sourceforge下载安装包。</p>

<h3>安装gnuplot</h3>

<p>然后再安装<code>gnuplot</code>，可以使用<code>brew</code>来安装：</p>

<pre><code>brew install gnuplot
</code></pre>

<p>如果<code>brew</code>安装的<code>gnuplot</code>没有<code>aqua term</code>，可以从源代码安装<code>gnuplot</code>。
方法如下：</p>

<p><a href="http://sourceforge.net/projects/gnuplot/files/gnuplot/4.6.0/">从sourceforge下载gnuplot的源代码</a>，
然后使用下面的命令编译并安装gnuplot</p>

<pre><code>./configure --prefix=/usr/local/Cellar/gnuplot/4.6.0
make &amp;&amp; make install
brew link gnuplot
</code></pre>

<h3>安装octave</h3>

<p>直接使用<code>brew</code>来安装<code>octave</code>：</p>

<pre><code>brew install octave
</code></pre>

<h3>测试安装是否成功</h3>

<p>在安装成功后，在命令行终端输入<code>octave</code>会启动<code>octave</code>，
然后输入如下指令，测试绘图功能是否正常。</p>

<pre><code>x = linspace(0, 2*pi, 100);
y = sin(x);
plot(x, y);
</code></pre>

<p>它会画一个<code>sin(x)</code>的曲线。</p>

<p><img src="/images/install-octave-on-mac/octave-figure-sinx.png" title="sin(x)" alt="picture alt" /></p>

<h2>参考</h2>

<ul>
<li><a href="http://www.gnu.org/software/octave/">Octave主页</a></li>
<li><a href="http://en.wikibooks.org/wiki/Octave_Programming_Tutorial">Octave教程</a></li>
<li><a href="http://www-mdp.eng.cam.ac.uk/web/CD/engapps/octave/octavetut.pdf">Introduction to Octave</a></li>
<li><a href="http://www.octave.org/wiki/index.php?title=Installing_MacOS_X_Bundle">Install Octave on MacOS</a></li>
<li><a href="http://en.wikibooks.org/wiki/MATLAB_Programming/Differences_between_Octave_and_MATLAB">MATLAB Programming/Differences between Octave and MATLAB</a></li>
<li><a href="http://www.gnuplot.info/">Gnuplot主页</a></li>
<li><a href="http://www.ibm.com/developerworks/cn/linux/l-gnuplot/">gnuplot 让您的数据可视化</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/06/25/learn-git/">学习一点git</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-06-25T21:29:00+08:00" pubdate data-updated="true">Jun 25<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/06/25/learn-git/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>git是什么东东？</h2>

<blockquote><p>Git is a fast, scalable, distributed revision control system with an unusually rich command set that provides both high-level operations and full access to internals.</p></blockquote>

<h2>git用法</h2>

<h3>GUI</h3>

<p><code>git</code>自带了个简单的GUI工具<code>gitk</code>。
在Mac下可以使用<code>SourceTree</code>（在app store）可以免费下载。</p>

<h3>获得帮助</h3>

<p><code>git</code>提供了help来获得帮助信息。</p>

<pre>
$ git help
usage: git [--version] [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]
           [-p|--paginate|--no-pager] [--no-replace-objects] [--bare]
           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]
           [-c name=value] [--help]
           <command> [<args>]

The most commonly used git commands are:
   add        Add file contents to the index
   bisect     Find by binary search the change that introduced a bug
   branch     List, create, or delete branches
   checkout   Checkout a branch or paths to the working tree
   clone      Clone a repository into a new directory
   commit     Record changes to the repository
   diff       Show changes between commits, commit and working tree, etc
   fetch      Download objects and refs from another repository
   grep       Print lines matching a pattern
   init       Create an empty git repository or reinitialize an existing one
   log        Show commit logs
   merge      Join two or more development histories together
   mv         Move or rename a file, a directory, or a symlink
   pull       Fetch from and merge with another repository or a local branch
   push       Update remote refs along with associated objects
   rebase     Forward-port local commits to the updated upstream head
   reset      Reset current HEAD to the specified state
   rm         Remove files from the working tree and from the index
   show       Show various types of objects
   status     Show the working tree status
   tag        Create, list, delete or verify a tag object signed with GPG

See 'git help <command>' for more information on a specific command.
</pre>


<p>比如要想得到关于commit命令的帮助信息，可以使用</p>

<pre><code>git help commit
</code></pre>

<h3>设置你的个人信息</h3>

<p>在你每次提交时会记录你的用户名和邮箱，可以使用如下命令进行设置。</p>

<pre><code>$ git config --global user.name "Your Name Comes Here"
$ git config --global user.email you@yourdomain.example.com
</code></pre>

<h3>创建一个新的git仓库</h3>

<pre><code>$ mkdir /path/to/your/project
$ cd /path/to/your/project
$ git init
$ git add .
$ git commit -m "First commit"
</code></pre>

<p><code>git init</code>会初始化一个<code>git</code>仓库，初始化后在当前目录会创建一个<code>.git</code>目录。</p>

<p><code>git add .</code>把当前目录和其子目录的文件加入版本控制系统，但是这个时候还没有真正的提交到仓库。</p>

<p><code>git commit</code>把<code>git add</code>产生的改动提交到仓库，<code>-m</code>参数提交的注释信息。</p>

<h3>提交修改过的文件</h3>

<p>使用<code>status</code>命令来查看有哪些文件修改过/新添加：</p>

<pre><code>$ git status
</code></pre>

<p>添加修改过的文件：</p>

<pre><code>$ git add file1 file2 …
</code></pre>

<p>显示修改过的文件的改动（只对使用<code>add</code>命令添加过的文件产生diff）：</p>

<pre><code>$ git diff --cached
</code></pre>

<p>显示修改过的文件的改动（对没有使用<code>add</code>命令添加过的文件产生diff）：</p>

<pre><code>$ git diff
</code></pre>

<p>提交修改到仓库：</p>

<pre><code>$ git commit -m "comments here..."
</code></pre>

<p>有时候你只想把某个时间点之后的所有改动都回滚掉，因为这些的改动是不正确的。
可以使用：</p>

<pre><code>$ git log
</code></pre>

<p>显示最近提交列表，以及他们的SHA1哈希值。然后通过<code>reset</code>命令来把修改抹掉：</p>

<pre><code>$ git reset --hard SHA1_HASH
</code></pre>

<p>这样会恢复到一个指定的提交状态，并从记录里永久抹掉所有比该记录更新的提交。</p>

<p>另一些时候你想简单地跳到一个旧状态。这种情况，键入：</p>

<pre><code>$ git checkout SHA1_HASH
</code></pre>

<p>这个操作将把你带回过去的某个版本。</p>

<p>如果要想要某些文件不受<code>git</code>管理，比如编译产生的中间文件。
可以在项目的根目录下创建一个文件<code>.gitignore</code>来过滤这些文件。</p>

<p>我的<code>.gitignore</code>如下</p>

<pre>
.DS_Store
.DS_Store?
._*
.Spotlight-V100
.Trashes
Icon?
ehthumbs.db
Thumbs.db

#
# xcode user settings
#
xcuserdata
</pre>


<p>更多的<code>.gitignore</code>可以参考<a href="https://github.com/github/gitignore">这里</a></p>

<p><code>.gitignore</code>是针对一个项目的，也可以通过设置<code>git</code>全局的配置来指定在所有的项目中都要忽略的文件。
比如你一个全局的配置文件<code>~/.gitignore_global</code>，使用下面的命令可以来指定：</p>

<pre><code>git config --global core.excludesfile ~/.gitignore_global
</code></pre>

<h3>修订历史</h3>

<p>要查看提交的历史记录，使用<code>log</code>命令：</p>

<pre>
$ git log
commit c82a22c39cbc32576f64f5c6b3f24b99ea8149c7
Author: Junio C Hamano <junkio@cox.net>
Date:   Tue May 16 17:18:22 2006 -0700

    merge-base: Clarify the comments on post processing.
</pre>


<p>要查看每次提交到底有哪些改动，加<code>-p</code>参数：</p>

<pre><code>$ git log -p
</code></pre>

<p><code>-p</code>输出非常详细，如果只想查看每次提交包含了哪些文件的改动，使用命令：</p>

<pre><code>$ git log --stat --summary
</code></pre>

<p>如果要查看某次提交具体做了哪些修改，使用<code>git show</code>命令：</p>

<pre><code>$ git show c82a22c39cbc32576f64f5c6b3f24b99ea8149c7
</code></pre>

<p>c82a22c39cbc32576f64f5c6b3f24b99ea8149c7是某次提交的hash值。
在使用<code>show</code>命令是不用每次都完整的输入，只需要输入前面的几个字符能唯一标识一次提交即可：</p>

<pre>
$ git show c82a22c39c   # the first few characters of the name are
                        # usually enough
$ git show HEAD         # the tip of the current branch
$ git show experimental # the tip of the "experimental" branch
</pre>


<p>如果要想使用图形界面查看，使用<code>gitk</code>：</p>

<pre><code>$ gitk
</code></pre>

<p>也可以使用网页形式来查看历史记录：</p>

<pre><code>$ git instaweb
</code></pre>

<p><code>instaweb</code>命令需要一个web服务器，如果是MAC，可以使用<code>brew</code>来安装一个<code>lighttpd</code></p>

<pre><code>$ brew install lighttpd
</code></pre>

<h3>分支管理</h3>

<p><code>git</code>支持在一个仓库中维护多个分支的功能。创建分支是非常轻量级的操作。
使用下面的命令创建一个名为“experimental”的分支：</p>

<pre><code>$ git branch experimental
</code></pre>

<p>使用<code>branch</code>命令来列出所有的分支：</p>

<pre><code>$ git branch
  experimental
* master
</code></pre>

<p>“experimental”分支是刚刚创建的分支，“master”分支是由系统自动创建的缺省分支。
星号（*）表示当前你当前工作在哪个分支上。</p>

<p>要在分支之间切换，使用<code>checkout</code>命令。下面的命令切换到“experimental”分支上：</p>

<pre><code>$ git checkout experimental
</code></pre>

<p>现在修改一些文件，然后在切换回“master”分支：</p>

<pre><code>(edit file)
$ git commit -a
$ git checkout master
</code></pre>

<p>然后在“master”分支上在做一些修改并提交：</p>

<pre><code>(edit file)
$ git commit -a
</code></pre>

<p>要合并“experimental”分支的修改到“master”分支，使用下面的命令：</p>

<pre><code>$ git merge experimental
</code></pre>

<p>如果没有冲突，合并会自动完成，如果有冲突，需要手动解决冲突。
使用<code>diff</code>命令来查看有<code>merge</code>有改动了哪些文件。</p>

<pre><code>$ git diff
</code></pre>

<p>在解决了冲突之后使用<code>commit</code>命令提交修改:</p>

<pre><code>$ git commit -a -m "commit on master…"
</code></pre>

<p>在分支上的修改都合并到之后并不在使用该分支时，可以使用<code>git branch -d</code>来删除该分支：</p>

<pre><code>$ git branch -d experimental
</code></pre>

<p>该命令会确保分支上的修改已经合并到“master”分支。</p>

<p>如果要强制删除一个分支，可以使用<code>git branch -D</code>来完成：</p>

<pre><code>$ git branch -D crazy-idea
</code></pre>

<p>该命令不会检查分支的合并状态，在分支上的修改会丢失。</p>

<h3>和远程仓库同步</h3>

<p>从远程仓库clone：</p>

<pre><code>$ git clone https://foobar@bitbucket.org/foobar/sandbox.git
</code></pre>

<p>把本地仓库同步到远程仓库上去：</p>

<pre><code>$ cd /path/to/my/repo
$ git remote add origin https://foobar@bitbucket.org/foobar/sandbox.git
$ git push -u origin master   # to push changes for the first time
</code></pre>

<h3>协作</h3>

<p>在<code>github</code>上如果对每个<code>repo</code>感兴趣，想提交代码的话，可以先在本地修改，然后通过<code>pull</code>请求把修改发送给对方。
具体操作方法如下：</p>

<ol>
<li>clone你感兴趣的<code>repo</code>到你自己的账号下。</li>
<li>在你的clone的<code>repo</code>修改代码并提交（可以在线修改并提交，如果代码改动小的比较合适。<code>github</code>太赞了）。</li>
<li>创建pull request。</li>
<li>发送pull request。</li>
</ol>


<p>操作细节参考：<a href="http://three20.info/article/2010-10-15-Editing-A-GitHub-Article">http://three20.info/article/2010-10-15-Editing-A-GitHub-Article</a>。</p>

<h2>git的竞争对手</h2>

<ul>
<li><a href="http://mercurial.selenic.com/">mercurial</a>是另一个分布式的版本控制系统。</li>
</ul>


<h2>参考</h2>

<ul>
<li><a href="http://www.kernel.org/pub/software/scm/git/docs/user-manual.html">git用户手册</a></li>
<li><a href="http://www.kernel.org/pub/software/scm/git/docs/">git命令行参考手册</a></li>
<li><a href="http://www.kernel.org/pub/software/scm/git/docs/gittutorial.html">git入门教程</a></li>
<li><a href="http://www.kernel.org/pub/software/scm/git/docs/everyday.html">git常用命令</a></li>
<li><a href="http://www.kernel.org/pub/software/scm/git/docs/gitworkflows.html">gitworkflows - An overview of recommended workflows with git</a></li>
<li><a href="http://three20.info/article/2010-10-15-Editing-A-GitHub-Article">怎样使用github的协作功能</a></li>
<li><a href="http://code.google.com/p/support/wiki/DVCSAnalysis">Analysis of Git and Mercurial</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/06/22/html5-resources/">学习一点HTML5</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-06-22T22:13:00+08:00" pubdate data-updated="true">Jun 22<span>nd</span>, 2012</time>
        
         | <a href="/blog/2012/06/22/html5-resources/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>HTML5是什么</h2>

<blockquote><p>HTML is the publishing language of the World Wide Web.</p></blockquote>


<p>HTML5时下比较时髦，Adobe在移动终端上放弃了Flash而转投HTML5。
微软虽然有自家的Sliverlight，但是还是高调的支持HTML5。
那HTML5到底有些什么东西呢？</p>

<p>其实HTML5不是一个单独的标准，而是一系列的标准的合集。
最主要的新特性包括：</p>

<ul>
<li>Canvas</li>
<li>Video</li>
<li>Audio</li>
<li>SVG的支持</li>
</ul>


<h2>What&#8217;s new in HTML5</h2>

<p>HTML5有哪些新东西呢？</p>

<h3>doctype和charset</h3>

<p>HTML5的doctype声明只有一种，即html。不是html5哦。</p>

<pre><code>&lt;!doctype html&gt;
</code></pre>

<p>要声明文档的字符编码方式也很简单，使用charset即可。</p>

<pre><code>&lt;meta charset="UTF-8"&gt;
</code></pre>

<h3>新增的支持文档结构化的标签</h3>

<p>为了更好的定义页面的布局，HTML5引入了一下新的标签用来支持页面的布局。</p>

<ul>
<li>&lt;section&gt; - to define sections of pages</li>
<li>header - defines the header of a page</li>
<li>footer - defines the footer of a page</li>
<li>nav - defines the navigation on a page</li>
<li>article - defines the article or primary content on a page</li>
<li>aside - defines extra content like a sidebar on a page</li>
<li>figure - defines images that annotate an article</li>
</ul>


<h3>新增支持内联的标签</h3>

<p>为了更好的表达语义和基本感念，新增了如下标签：</p>

<ul>
<li>mark - to indicate content that is marked in some fashion</li>
<li>time - to indicate content that is a time or date</li>
<li>meter - to indicate content that is a fraction of a known range - such as disk usage</li>
<li>progress - to indicate the progress of a task towards completion</li>
</ul>


<h3>对动态页面的支持</h3>

<ul>
<li>Context menus - HTML 5 will support the creation and use of context menus within Web pages and applications</li>
<li>href is not required on a tag - this allows you to use the a tag with scripts and in Web applications without needing a place to send that anchor</li>
<li>async attribute - This is added to the script tag to tell the browser that the script should be loaded asynchronously so that it doesn&#8217;t slow down the load and display of the rest of the page.</li>
<li>&lt;details&gt; - provides details about an element. This would be like tooltips in non-Web applications.</li>
<li>&lt;datagrid&gt; - creates a table that is built from a database or other dynamic source</li>
<li>&lt;menu&gt; - an old tag brought back and given new life allowing you to create a menu system on your Web pages</li>
<li>&lt;command&gt; - defines actions that should happen when a dynamic element is activated</li>
</ul>


<h3>对表单的增强</h3>

<p>为了更明确的表达表单的元素类型，HTML5新增了如下的表单元素类型：</p>

<ul>
<li>datetime</li>
<li>datetime-local</li>
<li>date</li>
<li>month</li>
<li>week</li>
<li>time</li>
<li>number</li>
<li>range</li>
<li>email</li>
<li>url</li>
</ul>


<h3>新增的支持多媒体的标签</h3>

<p>以下三个标签是新增标签中最吸引人的。有了它们你可以在浏览器里自由的画画和直接播放音频和视频。
它们是Flash的杀手。</p>

<ul>
<li>&lt;canvas&gt; - an element to give you a drawing space in JavaScript on your Web pages. It can let you add images or graphs to tool tips or just create dyanmic graphs on your Web pages, built on the fly.</li>
<li>&lt;video&gt; - add video to your Web pages with this simple tag.</li>
<li>&lt;audio&gt; - add sound to your Web pages with this simple tag.</li>
</ul>


<h3>不再支持的标签</h3>

<p>HTML5不再支持HTML4里支持的一下标签，如下</p>

<ul>
<li>acronym</li>
<li>applet</li>
<li>basefont</li>
<li>big</li>
<li>center</li>
<li>dir</li>
<li>font</li>
<li>frame</li>
<li>frameset</li>
<li>isindex</li>
<li>noframes</li>
<li>noscript</li>
<li>s</li>
<li>strike</li>
<li>tt</li>
<li>u</li>
</ul>


<p>不用意外，其中的大部分标签很早就被标记为不推荐使用的了。</p>

<h2>浏览器对HTML5的支持程度</h2>

<p>要看看你的当前使用的浏览器到底对HTML5的支持程度如何，可以访问
<a href="http://html5test.com/">html5test</a>
这个网站，它会给你的浏览器打个分，并标注你的浏览器支持哪些HTML5的特性。
<a href="http://html5test.com/">试试吧</a>。</p>

<p>各大浏览器厂商对HTML5支持的对比测试：
<a href="http://html5test.com/compare/browser/chrome19/ff13/ie09.html">Chrome19 vs. Firefox 13 vs. IE9</a></p>

<h2>HTML5的Logo</h2>

<p>连W3C也赶时髦而制作了一系列的HTML5的logo</p>

<p><img src="/images/html5-resources/HTML5_Logo_256.png" title="HTML5 Logo" alt="picture alt" /></p>

<h2>HTML5相关资源</h2>

<ul>
<li><a href="http://www.w3schools.com/html5/">w3schools的HTML5教程</a></li>
<li><a href="http://www.ibm.com/developerworks/cn/web/wa-html5fundamentals/index.html">IBM Developerworks上的HTML5教程</a></li>
<li><a href="http://www.w3.org/TR/html5/">W3C的HTML5标准（草案）</a></li>
<li><a href="http://dev.w3.org/html5/html4-differences/">HTML5 differences from HTML4</a></li>
<li><a href="http://webdesign.about.com/od/html5/a/html_5_whats_new.htm">What&#8217;s New in HTML5</a></li>
<li><a href="http://www.w3.org/html/logo/">HTML5图标</a>: 各种样式和大小的HTML5的图标。</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/01/16/windows-phone-debug-message-output/">WP7中写调试消息</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-16T21:55:00+08:00" pubdate data-updated="true">Jan 16<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/01/16/windows-phone-debug-message-output/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>在WP7中写调试消息</p>

<pre><code>    System.Diagnostics.Debug.WriteLine("Debug message here...");
</code></pre>

<p>说明:</p>

<ol>
<li>这个只有在调试版本才有效。</li>
<li>在VS2010的Output窗口可以看到输出。</li>
</ol>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/01/13/install-wp7-sdk-on-xp/">在XP下安装WP7的SDK</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-13T22:12:00+08:00" pubdate data-updated="true">Jan 13<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/01/13/install-wp7-sdk-on-xp/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><ol>
<li><p>下载 WP7 SDK 的安装文件: <code>vm_web.exe</code></p></li>
<li><p>解压缩安装包：</p>

<pre><code> vm_web.exe /x
</code></pre></li>
<li><p>到解压缩的目录中修改安装配置，要修改的文件为<code>baseline.dat</code></p>

<p> 找到 gencomp7788 配置，并修改如下配置：</p>

<pre><code> InstallOnLHS=0
 InstallOnWinXP=0
</code></pre></li>
<li><p>运行安装</p>

<pre><code> setup.exe /web
</code></pre></li>
</ol>


<p>参考:</p>

<ul>
<li><a href="http://www.redfrogfish.com/483/how-to-install-windows-phone-7-developer-tools-on-windows-xp/">http://www.redfrogfish.com/483/how-to-install-windows-phone-7-developer-tools-on-windows-xp/</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/01/02/how-to-use-wp7-as-usb-drive/">How to Use WP7 as USB Drive</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-02T21:21:00+08:00" pubdate data-updated="true">Jan 2<span>nd</span>, 2012</time>
        
         | <a href="/blog/2012/01/02/how-to-use-wp7-as-usb-drive/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>How to use WP7 as usb drive ?</p>

<p>If your like me and like to save things on your phone then this is for you. I found it yesterday and it works fine I now have all my stuff on my HD7.</p>

<p>Open Windows Registry Editor by typing regedit in your start menu
- Go to HKEY_LOCAL_MACHINE\SYSTEM\
- Then go to HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Enum\U SB (and not the other ControlSet01 or 02 if you have them) and then search for ZuneDriver</p>

<ul>
<li>Change ShowInShell from 0 to 1 &lt;- this enable Windows Explorer to show the device when pluged in</li>
<li>Change PortableDeviceNameSpaceExcludeFromShell from 1 to 0</li>
<li>Change EnableLegacySupport from 0 to 1 &lt;- this enables Windows Explorer to detect the device</li>
<li>You can also change EnableDefaultAutoPlaySupport but it didn’t seem to do anything.</li>
</ul>


<p>Once its done just plug-in your device to your PC. The Zune software will automatically launch as usual and your device will also appear in the Windows explorer</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/12/29/web-developer-tools-bookmark/">网站开发书签</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-29T20:32:00+08:00" pubdate data-updated="true">Dec 29<span>th</span>, 2011</time>
        
         | <a href="/blog/2011/12/29/web-developer-tools-bookmark/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><ul>
<li>一个在线调试和共享js代码的网站：<a href="http://jsfiddle.net">http://jsfiddle.net</a></li>
<li>Email icon generator：<a href="http://services.nexodyne.com/email/index.php">http://services.nexodyne.com/email/index.php</a></li>
<li>在线把网页转换为pdf：<a href="http://www.printfriendly.com/">http://www.printfriendly.com/</a></li>
<li>Web模板下载：<a href="http://960.gs/">http://960.gs/</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/12/28/jquery-revert-selection/">jQuery Reverse Selection</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-28T22:12:00+08:00" pubdate data-updated="true">Dec 28<span>th</span>, 2011</time>
        
         | <a href="/blog/2011/12/28/jquery-revert-selection/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>TODO&#8230;</p>

<script>
(function($) {
  $.fn.reverse = function () 
  {
      var orig = this.prevObject;
      return orig.not(this) || jQuery(null);
  }
})(jQuery);

$('li').css('background-color','gray')
    .filter(':contains("sub")')
    .css('color','yellow')
    .reverse()
    .css('color','red');
</script>




<ul>
  <li>sub 1</li>
  <li>inv 1</li>
  <li>sub 2</li>
  <li>inv 2</li>
</ul>




<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">reverse</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">orig</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">prevObject</span><span class="p">;</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">orig</span><span class="p">.</span><span class="nx">not</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="o">||</span> <span class="nx">jQuery</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">})(</span><span class="nx">jQuery</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;background-color&#39;</span><span class="p">,</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s1">&#39;:contains(&quot;sub&quot;)&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span><span class="s1">&#39;yellow&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">reverse</span><span class="p">()</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span><span class="s1">&#39;red&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>参考</p>

<ul>
<li><a href="http://stackoverflow.com/questions/4502533/jquery-method-to-select-a-subset-and-also-its-inverse">http://stackoverflow.com/questions/4502533/jquery-method-to-select-a-subset-and-also-its-inverse</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/12/24/jquery-tree-filter/">实现jQuery的treeview的filter</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-24T21:21:00+08:00" pubdate data-updated="true">Dec 24<span>th</span>, 2011</time>
        
         | <a href="/blog/2011/12/24/jquery-tree-filter/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>使用jQuery的treeview插件做了一个tree，遇到一个tree特别长的问题，
需要做一下filter，方便查找。</p>

<p>做tree的filter可以这样实现：</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#filter&quot;</span><span class="p">).</span><span class="nx">change</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">tval</span><span class="o">=</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;li&quot;</span><span class="p">).</span><span class="nx">hide</span><span class="p">()</span>
</span><span class='line'>         <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;:contains(&#39;&quot;</span><span class="o">+</span><span class="nx">tval</span><span class="o">+</span><span class="s2">&quot;&#39;)&quot;</span><span class="p">)</span>
</span><span class='line'>         <span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">)</span>
</span><span class='line'>         <span class="p">.</span><span class="nx">andSelf</span><span class="p">()</span>
</span><span class='line'>         <span class="p">.</span><span class="nx">show</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">all</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;li span.file&quot;</span><span class="p">,</span> <span class="nx">tree</span><span class="p">).</span><span class="nx">parent</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">selects</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;li span.file a&quot;</span><span class="p">,</span> <span class="nx">tree</span><span class="p">)</span>
</span><span class='line'>                 <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;:contains(&#39;&quot;</span> <span class="o">+</span> <span class="nx">filter</span> <span class="o">+</span> <span class="s2">&quot;&#39;)&quot;</span><span class="p">)</span>
</span><span class='line'>                 <span class="p">.</span><span class="nx">parent</span><span class="p">()</span>
</span><span class='line'>                 <span class="p">.</span><span class="nx">parent</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">all</span><span class="p">.</span><span class="nx">not</span><span class="p">(</span><span class="nx">selects</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>参考</p>

<ul>
<li><a href="http://stackoverflow.com/questions/3691201/jquery-how-hide-show-tree-elements-based-on-search-criteria">http://stackoverflow.com/questions/3691201/jquery-how-hide-show-tree-elements-based-on-search-criteria</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/12/22/linux-reset-terminal/">在Linux下清屏是clear还是reset</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-22T19:21:00+08:00" pubdate data-updated="true">Dec 22<span>nd</span>, 2011</time>
        
         | <a href="/blog/2011/12/22/linux-reset-terminal/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>在终端中<code>Ctrl+L</code>或者<code>clear</code>会重绘屏幕。
它能清除由系统广播消息导致的屏幕混乱情况。
但如果是由于屏幕上打印了一些控制字符引起的屏幕混乱，
<code>Ctrl+L</code>就没有效果了，这个时候需要使用<code>reset</code>命令。</p>

<blockquote><p>There is garbage on the screen, or all your keystrokes are echoed as line drawing characters. What to do?</p><p>Many programs will redraw the screen when `Ctrl-L` is typed. This might help when there is some modem noise or broadcast<br/>message on your screen. The command `clear` will clear the screen.</p><p>The command `reset` will reset the console driver. This helps when the screen is full of funny graphic characters, and<br/>also if it is reduced to the bottom line.</p><footer><strong>Resetting your terminal</strong> <cite><a href='http://tldp.org/HOWTO/Keyboard-and-Console-HOWTO-4.html'>Linux Howto</a></cite></footer></blockquote>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/12/20/cookie-expries-issue-on-django-auth/">服务器时间不正确导致django的认证失败</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-20T08:20:00+08:00" pubdate data-updated="true">Dec 20<span>th</span>, 2011</time>
        
         | <a href="/blog/2011/12/20/cookie-expries-issue-on-django-auth/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>平时跑的好好的django系统，突然发现IE登录后可以访问第一个页面，
而再继续访问其它页面的时候就出现认证失败，而Firefox是没有问题的。
django的认证是借助cookie来实现的。</p>

<p>经过对IE的抓包分析发现在后续的请求没有携带Cookie，
而在仔细看之前的http请求和响应，发现登录时服务器返回的Set-Cookie的超时时间是去年的时间，这就导致了IE认为这个Cookie已经过期，在后续的请求中就没有把这个Cookie带上，导致了认证的失败。再到服务器上看，服务器的时间居然被人改成去年的时间了。</p>

<p>解决方法很简单了，就是把服务器的时间修改正确。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/12/04/how-to-use-nettl-on-hpux/">在HP-UX上使用nettl抓包</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-04T10:16:00+08:00" pubdate data-updated="true">Dec 4<span>th</span>, 2009</time>
        
         | <a href="/blog/2009/12/04/how-to-use-nettl-on-hpux/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>HP-UX 自己提供了抓包工具<code>nettl</code> 。
在<code>tcpdump</code>不能用的时候它（比如<code>tcpdump</code>在HP-UX上就不能抓回环上的包）就派上用场了。</p>

<p>总结一下<code>nettl</code>的主要用法，备查。</p>

<h2>开始抓包</h2>

<p>使用<code>nettl -tn</code>开始抓包，下面是一些常用的命令：</p>

<pre><code># nettl -tn all -e all -maxtrace 99999 -f /tmp/tx
# nettl -tn loopback -e ns_ls_tcp -maxtrace 99999 -f /tmp/tx
# nettl -tn pduin pduout -e ns_ls_loopback -tm 100000 -f /tmp/local
# nettl -tn pduin pduout -e ns_ls_loopback -m 56 -tm 100000 -f /tmp/local
# nettl -tn pduin -e ns_ls_loopback -m 56 -tm 100000 -f /tmp/local
</code></pre>

<p>-m size 限制每个包的大小。我们不一定对所有的包都感兴趣，在只对包头干兴趣的时候这个选项就非常有效。
比如某协议使用的包头为16个字节，再加上IP头的20个字节，TCP头的20个字节，
也就是我们只需要总共56个字节就能确定一个包的基本信息了。</p>

<p>-e subsytem 要抓包的类型，可以使用<code>nettl -status</code>来获取。</p>

<pre><code>ns_ls_loopback
ns_ls_ip
ns_ls_tcp
ns_ls_udp
ns_ls_icmp
</code></pre>

<p>-tm maxsize 每个文件的最大大小，如果超过此大小，会使用下一个抓包文件。
单位：KB。有效值：100~99999</p>

<p>抓包的输出文件为 <code>/tmp/tx.xxxx</code>，使用<code>ls -l /tmp/tx.*</code>来检查</p>

<p>说明：</p>

<p>在<code>ns_ls_loopback</code>上抓包如果指定了<code>pduin</code>和<code>pduout</code>每个包会抓到2份，因为一进一出就是两份。
如果指定<code>-tn all -e all</code>一个包也会抓到多份，因为一个包可能属于不同的<code>subsystem</code>，
比如一个<code>tcp</code>包既属于<code>tcp</code>，也属于<code>ip</code>等。</p>

<p>抓的包可以使用<code>wireshark</code>来直接打开并进行分析。也可以使用HP-UX自带的<code>netfmt</code>来分析。</p>

<p>查看状态及<code>-entity</code>可用的信息：</p>

<pre><code># nettl -status
</code></pre>

<h2>停止抓包</h2>

<p>使用<code>nettl -tf</code>来停止抓包。</p>

<pre><code># nettl -tf -e all
</code></pre>

<h2>对包的分析</h2>

<p>我们可以使用netfmt来查看捕获的包：</p>

<pre><code>netfmt -N -l -f /tmp/nettl_t* | more
</code></pre>

<p>可以过滤我们感兴趣的包，使用<code>-c</code>来传入过滤文件</p>

<pre><code>netfmt -N -l -c filter -f /tmp/nettl_t* | more
</code></pre>

<p>filter 为过滤文件，文件内容的类似如下：</p>

<pre><code>filter tcp_sport 1234
filter tcp_dport 1234
</code></pre>

<p>每一行为一个过滤条件，行与行之间是或的关系。</p>

<p>使用行模式来显示（这种模式下不会看到包的具体数据）</p>

<pre><code>netfmt -N -n -l -1 -f /tmp/nettl_t* | more
</code></pre>

<p>在每行的显示前加上时间戳</p>

<pre><code>netfmt -T -n -l -1 -f /tmp/nettl_t* | more
</code></pre>

<p>参考：</p>

<ul>
<li><a href="http://www.compute-aid.com/nettl.html">http://www.compute-aid.com/nettl.html</a></li>
<li><a href="http://docs.hp.com/en/B2355-60105/nettl.1M.html">http://docs.hp.com/en/B2355-60105/nettl.1M.html</a></li>
<li><a href="http://docs.hp.com/en/B2355-60105/netfmt.1M.html">http://docs.hp.com/en/B2355-60105/netfmt.1M.html</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/11/08/using-hill-climbing-algorithm-to-solve-n-queues-problem/">N皇后问题 - 使用随机爬山法实现其快速解法</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-08T10:11:00+08:00" pubdate data-updated="true">Nov 8<span>th</span>, 2009</time>
        
         | <a href="/blog/2009/11/08/using-hill-climbing-algorithm-to-solve-n-queues-problem/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>N皇后问题是一个经典的问题，在很多地方都有讨论过。
回溯法是经典的解法，但是随着N的增大，其复杂度的增加呈指数增长，
如果N=100使用回溯解法的话，回溯要运行的时间估计你可以去喝一壶茶了。</p>

<p>这段时间在看《人工智能》，里面也有对其的讨论，介绍了爬山法在N皇后问题中的应用。
爬山法是一种向值增加的方向持续移动到简单循环过程，它将会在到达一个“峰顶”时终止，
此时相邻状态中没有比该它更高的值。这个算法不维护搜索树。</p>

<p>最基本的爬上搜索算法(节选自《人工智能》第二版)：</p>

<figure class='code'><figcaption><span>随机爬山算法 </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>function HILL-CLIMBING(problem) return a state thate is a locak maximum
</span><span class='line'>    inputs: problem
</span><span class='line'>    local variables: current, a node
</span><span class='line'>                         neighbor,a node
</span><span class='line'>    current = MakeNode(INITAL-STATE(problem));
</span><span class='line'>    loop do
</span><span class='line'>        neighbor = a highest-valued successor of current ;
</span><span class='line'>        if VALUE[neighbor] &lt;= VALUE[current] then return STATE[current];
</span><span class='line'>        current = neighbor ;</span></code></pre></td></tr></table></div></figure>


<p>爬山法属于一种局部的贪婪搜索方法，当它在搜索过程中遇到了局部最大值就很难继续向下搜索了。因此产生了爬山法的变种如随机爬山法及其变种如随机爬山法，随机重新开始的爬山法，
模拟退火搜索能够非常有效的解决N皇后问题。</p>

<p>结合实际，我使用了随机爬山法的一个测试程序，不试不知道，测试发现速度果然是非常的快，
对于100皇后都是瞬间秒杀。不过这个程序要实现百万皇后的问题秒杀，估计还是一项很艰巨的工作。
不过随机爬山法这种方法是一种很有效的解决复杂搜索问题的方法之一。</p>

<p>程序如下，供以后参考：</p>

<figure class='code'><figcaption><span>使用随机爬山法解决N皇后问题 </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;stdlib.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;iostream&gt;</span>
</span><span class='line'><span class="cp">#include &lt;iterator&gt;</span>
</span><span class='line'><span class="cp">#include &lt;vector&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">CollisionList_t</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">print_row_mark</span><span class="p">(</span><span class="kt">int</span> <span class="n">N</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">N</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;+---&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;+&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">print_row</span><span class="p">(</span><span class="kt">int</span> <span class="n">N</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fill</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">N</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;| &quot;</span> <span class="o">&lt;&lt;</span> <span class="p">((</span><span class="n">i</span><span class="o">==</span><span class="n">fill</span><span class="p">)</span> <span class="o">?</span> <span class="sc">&#39;X&#39;</span> <span class="o">:</span> <span class="sc">&#39; &#39;</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; &quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;|&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">print_row_mark</span><span class="p">(</span><span class="n">N</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 皇后位置的表示方法:</span>
</span><span class='line'><span class="c1">// 使用数组chessman[N]来表示N个皇后的位置</span>
</span><span class='line'><span class="c1">// 第i个皇后chessman[i]的下标i表示其行所在的位置，</span>
</span><span class='line'><span class="c1">// chessman[i]表示其列的位置。</span>
</span><span class='line'><span class="c1">//</span>
</span><span class='line'><span class="c1">// 一个四皇后问题的表示方法如下所示：</span>
</span><span class='line'><span class="c1">// (0, 1) (1, 3) (2, 0) (3, 2)</span>
</span><span class='line'><span class="c1">// +---+---+---+---+</span>
</span><span class='line'><span class="c1">// |   | X |   |   |</span>
</span><span class='line'><span class="c1">// +---+---+---+---+</span>
</span><span class='line'><span class="c1">// |   |   |   | X |</span>
</span><span class='line'><span class="c1">// +---+---+---+---+</span>
</span><span class='line'><span class="c1">// | X |   |   |   |</span>
</span><span class='line'><span class="c1">// +---+---+---+---+</span>
</span><span class='line'><span class="c1">// |   |   | X |   |</span>
</span><span class='line'><span class="c1">// +---+---+---+---+</span>
</span><span class='line'><span class="c1">//</span>
</span><span class='line'><span class="kt">void</span> <span class="n">print_chessboard</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span> <span class="n">chessman</span><span class="p">,</span> <span class="kt">int</span> <span class="n">N</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">N</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;(&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">chessman</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;) &quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">print_row_mark</span><span class="p">(</span><span class="n">N</span><span class="p">);</span>
</span><span class='line'>  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">N</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">print_row</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">chessman</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 随机生成一个初始化状态，在每行每列上放置一个皇后</span>
</span><span class='line'><span class="kt">void</span> <span class="n">generate_init_state</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span> <span class="n">chessman</span><span class="p">,</span> <span class="kt">int</span> <span class="n">N</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">N</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">chessman</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">N</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">r</span> <span class="o">=</span> <span class="n">rand</span><span class="p">();</span>
</span><span class='line'>    <span class="n">r</span> <span class="o">=</span> <span class="n">r</span> <span class="o">%</span> <span class="n">N</span><span class="p">;</span>
</span><span class='line'>    <span class="n">std</span><span class="o">::</span><span class="n">swap</span><span class="p">(</span><span class="n">chessman</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">chessman</span><span class="p">[</span><span class="n">N</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">]);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 返回冲突的皇后个数</span>
</span><span class='line'><span class="kt">int</span> <span class="n">h</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span> <span class="n">chessman</span><span class="p">,</span> <span class="kt">int</span> <span class="n">N</span><span class="p">,</span> <span class="n">CollisionList_t</span><span class="o">&amp;</span> <span class="n">collision_list</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">collision_list</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">int</span> <span class="n">collision</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">N</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">row</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span> <span class="n">row</span><span class="o">&lt;</span><span class="n">N</span><span class="p">;</span> <span class="n">row</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">((</span><span class="n">chessman</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">==</span> <span class="n">chessman</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span>
</span><span class='line'>          <span class="o">||</span> <span class="p">(</span><span class="n">chessman</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">==</span> <span class="n">chessman</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">row</span> <span class="o">-</span> <span class="n">i</span><span class="p">)))</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">collision_list</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">row</span><span class="p">);</span>
</span><span class='line'>        <span class="o">++</span><span class="n">collision</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="n">collision</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 如果交换后冲突不比原来的大，就进行交换</span>
</span><span class='line'><span class="c1">// 只有交换成功后才改变cl为新的冲突列表</span>
</span><span class='line'><span class="kt">int</span> <span class="n">try_exchange</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span> <span class="n">chessman</span><span class="p">,</span> <span class="kt">int</span> <span class="n">N</span><span class="p">,</span> <span class="kt">int</span> <span class="n">row1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">row2</span><span class="p">,</span> <span class="n">CollisionList_t</span><span class="o">&amp;</span> <span class="n">cl</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">CollisionList_t</span> <span class="n">new_cl</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// 交换两行的皇后的位置</span>
</span><span class='line'>  <span class="n">std</span><span class="o">::</span><span class="n">swap</span><span class="p">(</span><span class="n">chessman</span><span class="p">[</span><span class="n">row1</span><span class="p">],</span> <span class="n">chessman</span><span class="p">[</span><span class="n">row2</span><span class="p">]);</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">new_collision</span> <span class="o">=</span> <span class="n">h</span><span class="p">(</span><span class="n">chessman</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">new_cl</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">new_collision</span> <span class="o">&gt;</span> <span class="n">cl</span><span class="p">.</span><span class="n">size</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// 取消之前的交换</span>
</span><span class='line'>    <span class="n">std</span><span class="o">::</span><span class="n">swap</span><span class="p">(</span><span class="n">chessman</span><span class="p">[</span><span class="n">row1</span><span class="p">],</span> <span class="n">chessman</span><span class="p">[</span><span class="n">row2</span><span class="p">]);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">cl</span> <span class="o">=</span> <span class="n">new_cl</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="n">new_cl</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">choose_next_state</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span> <span class="n">chessman</span><span class="p">,</span> <span class="kt">int</span> <span class="n">N</span><span class="p">,</span> <span class="n">CollisionList_t</span><span class="o">&amp;</span> <span class="n">cl</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">old_collision</span> <span class="o">=</span> <span class="n">cl</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">new_collision</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">int</span> <span class="n">row1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">row2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// 优化最后只有一个冲突的解</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">cl</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">N</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">cl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">try_exchange</span><span class="p">(</span><span class="n">chessman</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">cl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="n">cl</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">do</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// 最后的选择，随机的选择两个皇后调换其位置</span>
</span><span class='line'>    <span class="n">row1</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="n">N</span><span class="p">;</span>
</span><span class='line'>    <span class="k">do</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">row2</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="n">N</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">row1</span> <span class="o">==</span> <span class="n">row2</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="n">new_collision</span> <span class="o">=</span> <span class="n">try_exchange</span><span class="p">(</span><span class="n">chessman</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">row1</span><span class="p">,</span> <span class="n">row2</span><span class="p">,</span> <span class="n">cl</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">new_collision</span> <span class="o">&gt;</span> <span class="n">old_collision</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="n">new_collision</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 使用随机爬山法寻找一个N皇后问题的解</span>
</span><span class='line'><span class="kt">int</span> <span class="n">queue_solution</span><span class="p">(</span><span class="kt">int</span> <span class="n">N</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">int</span><span class="o">*</span> <span class="n">chessman</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">max_tries</span> <span class="o">=</span> <span class="n">N</span><span class="o">*</span><span class="n">N</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">max_steps</span> <span class="o">=</span> <span class="n">N</span><span class="o">*</span><span class="n">N</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">tries</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="k">while</span> <span class="p">(</span><span class="n">tries</span> <span class="o">&lt;</span> <span class="n">max_tries</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="o">++</span><span class="n">tries</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="kt">int</span> <span class="n">steps</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>      <span class="kt">int</span> <span class="n">collision</span><span class="p">;</span>
</span><span class='line'>      <span class="n">CollisionList_t</span> <span class="n">collision_list</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">srand</span><span class="p">(</span><span class="n">time</span><span class="p">(</span><span class="nb">NULL</span><span class="p">)</span> <span class="o">+</span> <span class="n">tries</span> <span class="o">*</span> <span class="n">collision</span><span class="p">);</span>
</span><span class='line'>      <span class="n">generate_init_state</span><span class="p">(</span><span class="n">chessman</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
</span><span class='line'>      <span class="n">collision</span> <span class="o">=</span> <span class="n">h</span><span class="p">(</span><span class="n">chessman</span><span class="p">,</span>  <span class="n">N</span><span class="p">,</span> <span class="n">collision_list</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">while</span> <span class="p">((</span><span class="n">collision</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">steps</span><span class="o">&lt;</span><span class="n">max_steps</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">collision</span> <span class="o">=</span> <span class="n">choose_next_state</span><span class="p">(</span><span class="n">chessman</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">collision_list</span><span class="p">);</span>
</span><span class='line'>        <span class="o">++</span><span class="n">steps</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="n">collision</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Found a solution. Tries: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">tries</span>
</span><span class='line'>            <span class="o">&lt;&lt;</span> <span class="s">&quot; Steps: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">steps</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'>          <span class="n">print_chessboard</span><span class="p">(</span><span class="n">chessman</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
</span><span class='line'>          <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 接受一个命令行参数，要求为整数N，表示要寻找的解是N皇后问题。</span>
</span><span class='line'><span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>    <span class="c1">// 缺省为寻找8皇后问题的一个解</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">N</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span><span class='line'>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;N: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">N</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">N</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Input error: parameter must be a postive integer&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'>    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">srand</span><span class="p">(</span><span class="n">time</span><span class="p">(</span><span class="nb">NULL</span><span class="p">));</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">queue_solution</span><span class="p">(</span><span class="n">N</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Failed, please try re-run to get a solution.&quot;</span>
</span><span class='line'>      <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>TODO：在选择下一步的时候还有改进空间，比如优先从冲突的皇后中随机选择皇后进行下一次的位置调换等。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/11/06/write-secure-code/">编写安全的代码 Secure Coding</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-06T09:57:00+08:00" pubdate data-updated="true">Nov 6<span>th</span>, 2009</time>
        
         | <a href="/blog/2009/11/06/write-secure-code/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>今天又看了一下了安全编程的指南。看到对异常的处理部分，不由想到前两天在客户的环境中出现一个问题，
由于在捕获异常后没有完全释放之前获得锁，导致在程序出现异常后，某些资源一直处于被锁定状态。
最后只有重新启动应用才能释放资源。对异常的处理要非常的小心才是。</p>

<p>编写安全的代码的参考资料：</p>

<ul>
<li><p>[CERTSecCod] – CERT Secure Coding Standards
  <a href="https://www.securecoding.cert.org/confluence/display/seccode/CERT+Secure+Coding+Standards">https://www.securecoding.cert.org/confluence/display/seccode/CERT+Secure+Coding+Standards</a></p></li>
<li><p><a href="http://www.owasp.org/">http://www.owasp.org/</a> - Web Applications</p></li>
<li><p>[Posix] – The Open Group Base Specifications Issue 7, IEEE Std 1003.1-2008
  <a href="http://www.opengroup.org/onlinepubs/9699919799/nframe.html">http://www.opengroup.org/onlinepubs/9699919799/nframe.html</a></p></li>
<li><p>[STRLCPY] – strlcpy and strlcat&#8211;Consistent, Safe, String Copy and Concatenation
  <a href="http://www.usenix.org/events/usenix99/millert.html">http://www.usenix.org/events/usenix99/millert.html</a></p></li>
<li><p>[CppStdLib] – C++ Library Reference
  <a href="http://www.cplusplus.com/reference/">http://www.cplusplus.com/reference/</a></p></li>
</ul>


<p>Books:</p>

<ul>
<li>“The CERT C Secure Coding Standard”, Robert C. Seacord, Addison-Wesley Professional, 2008, ISBN-10: 0321563212, ISBN-13: 978-0321563217</li>
<li>“Secure Coding in C and C++”, Robert C. Seacord, Addison-Wesley Professional, 2005, ISBN-10: 0321335724, ISBN-13: 978-0321335722</li>
</ul>


<p>Papers:</p>

<ul>
<li>ISO/IEC PDTR 24772, Information technology – Programming languages – Guidelines to avoiding vulnerabilities in language selection and use
<a href="http://isotc.iso.org/livelink/livelink/SC22-N-4420.pdf?func=doc.Fetch&amp;nodeId=7716670&amp;docTitle=SC22-N-4420">http://isotc.iso.org/livelink/livelink/SC22-N-4420.pdf?func=doc.Fetch&amp;nodeId=7716670&amp;docTitle=SC22-N-4420</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/10/24/the-2nd-chengdu-scrum-assemble/">The 2nd Chengdu Scrum Assemble</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-10-24T09:50:00+08:00" pubdate data-updated="true">Oct 24<span>th</span>, 2009</time>
        
         | <a href="/blog/2009/10/24/the-2nd-chengdu-scrum-assemble/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>今天参加了第二次的成都Scrum聚会，听到了一些新的Agile工具，在此列出以作备忘：</p>

<ul>
<li>Hudson，持续集成的工具。CruiseControl并不是唯一的选择。</li>
<li>NetBean，Eclipse的竞争者。</li>
<li>Mercurial，一个分布式的版本控制工具</li>
<li>xUnit</li>
<li>Sonar</li>
<li>Review Board</li>
<li>Maven</li>
<li>&#8230;</li>
</ul>


<p>大家有很多共识，软件开发中最关键的还是人。我认为软件开发需要做到的是 选择正确的人做正确的事。</p>

<blockquote><p>It all about people。</p></blockquote>


<p>关于<code>Self organization</code>，是有一个boundary的，
还记得ScrumMaster培训的时候那个小游戏在地上画的线吗？</p>

<p>在会上的抽奖节目中还有幸抽到了一本Scrum的书（虽然我看过它的英文版），也对组织者表示一下感谢。</p>

<p>我们的讨论组：<a href="http://groups.google.com/group/scrumcd">http://groups.google.com/group/scrumcd</a></p>

<p><a href="http://groups.google.com/group/scrumcd/browse_thread/thread/9f61abd1b9137125?hl=en">Presentation material from Agile Tour 2009 Chengdu</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/10/15/http-digest-auth-with-python/">使用Python实现HTTP的digest认证算法</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-10-15T09:39:00+08:00" pubdate data-updated="true">Oct 15<span>th</span>, 2009</time>
        
         | <a href="/blog/2009/10/15/http-digest-auth-with-python/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>因为测试需要，使用Python实现的的一个HTTP的digest认证算法。</p>

<p>关于HTTP的digest算法参考
<a href="http://www.ietf.org/rfc/rfc2617.txt">RFC 2617 - HTTP Authentication: Basic and Digest Access Authentication</a></p>

<p>代码如下：</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/env python</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># Author: Chen Ming</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># HTTP authentication: RFC 2671</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">hashlib</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">H</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span><span class='line'>  <span class="n">m</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>
</span><span class='line'>  <span class="n">m</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">KD</span><span class="p">(</span><span class="n">secret</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">H</span><span class="p">(</span><span class="n">secret</span> <span class="o">+</span> <span class="s">&#39;:&#39;</span> <span class="o">+</span> <span class="n">data</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c">#def auth_response(method, realm, username, password, uri, algorithm, nonce,</span>
</span><span class='line'><span class="c">#                  qop=&quot;&quot;, nc=&quot;&quot;, cnonce=&quot;&quot;, entity_body=&quot;&quot;):</span>
</span><span class='line'><span class="k">def</span> <span class="nf">auth_response</span><span class="p">(</span><span class="n">authinfo</span><span class="p">):</span>
</span><span class='line'>  <span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'><span class="sd">    method should be &#39;REGISTER&#39;</span>
</span><span class='line'><span class="sd">    realm should be &#39;PoC Service C1.0&#39;</span>
</span><span class='line'><span class="sd">  &quot;&quot;&quot;</span>
</span><span class='line'>  <span class="n">method</span> <span class="o">=</span> <span class="s">&#39;REGISTER&#39;</span>
</span><span class='line'>  <span class="n">username</span> <span class="o">=</span> <span class="n">authinfo</span><span class="p">[</span><span class="s">&#39;auth_username&#39;</span><span class="p">]</span>
</span><span class='line'>  <span class="n">realm</span> <span class="o">=</span> <span class="n">authinfo</span><span class="p">[</span><span class="s">&#39;auth_realm&#39;</span><span class="p">]</span>
</span><span class='line'>  <span class="n">password</span> <span class="o">=</span> <span class="n">authinfo</span><span class="p">[</span><span class="s">&#39;auth_password&#39;</span><span class="p">]</span>
</span><span class='line'>  <span class="n">uri</span> <span class="o">=</span> <span class="n">authinfo</span><span class="p">[</span><span class="s">&#39;auth_uri&#39;</span><span class="p">]</span>
</span><span class='line'>  <span class="n">qop</span> <span class="o">=</span> <span class="n">authinfo</span><span class="p">[</span><span class="s">&#39;auth_qop&#39;</span><span class="p">]</span>
</span><span class='line'>  <span class="n">body</span><span class="o">=</span> <span class="n">authinfo</span><span class="p">[</span><span class="s">&#39;auth_body&#39;</span><span class="p">]</span>
</span><span class='line'>  <span class="n">nonce</span> <span class="o">=</span> <span class="n">authinfo</span><span class="p">[</span><span class="s">&#39;auth_nonce&#39;</span><span class="p">]</span>
</span><span class='line'>  <span class="n">nc</span> <span class="o">=</span> <span class="n">authinfo</span><span class="p">[</span><span class="s">&#39;auth_nc&#39;</span><span class="p">]</span>
</span><span class='line'>  <span class="n">cnonce</span> <span class="o">=</span> <span class="n">authinfo</span><span class="p">[</span><span class="s">&#39;auth_cnonce&#39;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">A1</span> <span class="o">=</span> <span class="n">username</span> <span class="o">+</span> <span class="s">&#39;:&#39;</span> <span class="o">+</span> <span class="n">realm</span> <span class="o">+</span> <span class="s">&#39;:&#39;</span> <span class="o">+</span> <span class="n">password</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">qop</span> <span class="o">==</span> <span class="s">&quot;auth-int&quot;</span><span class="p">:</span>
</span><span class='line'>    <span class="n">A2</span> <span class="o">=</span> <span class="n">method</span> <span class="o">+</span> <span class="s">&#39;:&#39;</span> <span class="o">+</span> <span class="n">uri</span> <span class="o">+</span> <span class="s">&#39;:&#39;</span> <span class="o">+</span> <span class="n">H</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
</span><span class='line'>  <span class="k">else</span><span class="p">:</span>
</span><span class='line'>    <span class="c"># &quot;qop&quot; directive&#39;s value is &quot;auth&quot; or is unspecified</span>
</span><span class='line'>    <span class="n">A2</span> <span class="o">=</span> <span class="n">method</span> <span class="o">+</span> <span class="s">&#39;:&#39;</span> <span class="o">+</span> <span class="n">uri</span>
</span><span class='line'>
</span><span class='line'>  <span class="c">#print &quot;A1: %s\nA2:%s&quot; % (A1, A2)</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="n">qop</span> <span class="o">==</span> <span class="s">&#39;auth&#39;</span> <span class="ow">or</span> <span class="n">qop</span> <span class="o">==</span> <span class="s">&#39;auth-int&#39;</span><span class="p">:</span>
</span><span class='line'>    <span class="c"># OMA</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">KD</span><span class="p">(</span><span class="n">H</span><span class="p">(</span><span class="n">A1</span><span class="p">),</span> <span class="n">nonce</span> <span class="o">+</span> <span class="s">&#39;:&#39;</span> <span class="o">+</span> <span class="n">nc</span> <span class="o">+</span> <span class="s">&#39;:&#39;</span> <span class="o">+</span> <span class="n">cnonce</span> <span class="o">+</span> <span class="s">&#39;:&#39;</span> <span class="o">+</span> <span class="n">qop</span> <span class="o">+</span> <span class="s">&#39;:&#39;</span> <span class="o">+</span> <span class="n">H</span><span class="p">(</span><span class="n">A2</span><span class="p">))</span>
</span><span class='line'>  <span class="k">else</span><span class="p">:</span>
</span><span class='line'>    <span class="c"># &quot;qop&quot; directive is not present (Ph0+)</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">KD</span><span class="p">(</span><span class="n">H</span><span class="p">(</span><span class="n">A1</span><span class="p">),</span> <span class="n">nonce</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="n">H</span><span class="p">(</span><span class="n">A2</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">test_auth_response</span><span class="p">():</span>
</span><span class='line'>  <span class="c"># Ph0+</span>
</span><span class='line'>  <span class="c"># test auth</span>
</span><span class='line'>  <span class="n">response</span> <span class="o">=</span> <span class="n">auth_response</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">auth_realm</span> <span class="o">=</span> <span class="s">&#39;PoC Service C1.0&#39;</span><span class="p">,</span>
</span><span class='line'>                           <span class="n">auth_username</span> <span class="o">=</span> <span class="s">&#39;user100801@henry.poc.com&#39;</span><span class="p">,</span>
</span><span class='line'>                           <span class="n">auth_password</span> <span class="o">=</span> <span class="s">&#39;password&#39;</span><span class="p">,</span>
</span><span class='line'>                           <span class="n">auth_uri</span> <span class="o">=</span> <span class="s">&#39;sip:henry.poc.com&#39;</span><span class="p">,</span>
</span><span class='line'>                           <span class="n">auth_algorithm</span> <span class="o">=</span> <span class="s">&#39;MD5&#39;</span><span class="p">,</span>
</span><span class='line'>                           <span class="n">auth_nonce</span> <span class="o">=</span> <span class="s">&#39;b2c015055a88faed30bae04fb2d600ba&#39;</span><span class="p">,</span>
</span><span class='line'>                           <span class="n">auth_qop</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
</span><span class='line'>                           <span class="n">auth_nc</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
</span><span class='line'>                           <span class="n">auth_cnonce</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
</span><span class='line'>                           <span class="n">auth_body</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
</span><span class='line'>                          <span class="p">))</span>
</span><span class='line'>
</span><span class='line'>  <span class="c">#print response</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">expect_response</span> <span class="o">=</span> <span class="s">&#39;5249e6261d8d8268176230c9aea6bb69&#39;</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">response</span> <span class="o">==</span> <span class="n">expect_response</span><span class="p">:</span>
</span><span class='line'>    <span class="k">print</span> <span class="s">&quot;auth - OK&quot;</span>
</span><span class='line'>  <span class="k">else</span><span class="p">:</span>
</span><span class='line'>    <span class="k">print</span> <span class="s">&quot;auth - Failed&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c"># OMA</span>
</span><span class='line'>  <span class="c"># test auth-int</span>
</span><span class='line'>  <span class="n">response</span> <span class="o">=</span> <span class="n">auth_response</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">auth_realm</span> <span class="o">=</span> <span class="s">&#39;PoC Service C1.0&#39;</span><span class="p">,</span>
</span><span class='line'>                           <span class="n">auth_username</span> <span class="o">=</span> <span class="s">&#39;user100802@henry.poc.com&#39;</span><span class="p">,</span>
</span><span class='line'>                           <span class="n">auth_password</span> <span class="o">=</span> <span class="s">&#39;password&#39;</span><span class="p">,</span>
</span><span class='line'>                           <span class="n">auth_uri</span> <span class="o">=</span> <span class="s">&#39;sip:henry.poc.com;transport=UDP&#39;</span><span class="p">,</span>
</span><span class='line'>                           <span class="n">auth_algorithm</span> <span class="o">=</span> <span class="s">&#39;MD5&#39;</span><span class="p">,</span>
</span><span class='line'>                           <span class="n">auth_nonce</span> <span class="o">=</span> <span class="s">&#39;N0h9zqzvTnkAADgZVsBplA==&#39;</span><span class="p">,</span>
</span><span class='line'>                           <span class="n">auth_qop</span> <span class="o">=</span> <span class="s">&#39;auth-int&#39;</span><span class="p">,</span>
</span><span class='line'>                           <span class="n">auth_nc</span> <span class="o">=</span> <span class="s">&#39;00000001&#39;</span><span class="p">,</span>
</span><span class='line'>                           <span class="n">auth_cnonce</span> <span class="o">=</span> <span class="s">&#39;14d4043e584b63d901366cd5a64d8f66&#39;</span><span class="p">,</span>
</span><span class='line'>                           <span class="n">auth_body</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
</span><span class='line'>                          <span class="p">))</span>
</span><span class='line'>  <span class="n">expect_response</span> <span class="o">=</span> <span class="s">&#39;76f8201f832b94e8120daaab94b55a63&#39;</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">response</span> <span class="o">==</span> <span class="n">expect_response</span><span class="p">:</span>
</span><span class='line'>    <span class="k">print</span> <span class="s">&quot;auth-int - OK&quot;</span>
</span><span class='line'>  <span class="k">else</span><span class="p">:</span>
</span><span class='line'>    <span class="k">print</span> <span class="s">&quot;auth-int - Failed&quot;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
</span><span class='line'>  <span class="n">test_auth_response</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/09/11/when-call-register-handle-in-ace/">ACE中register_handler()的调用时机</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-09-11T09:36:00+08:00" pubdate data-updated="true">Sep 11<span>th</span>, 2009</time>
        
         | <a href="/blog/2009/09/11/when-call-register-handle-in-ace/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>这个问题源自ACE邮件列表中使用Reactor来进行串口通信的问题，
最后的根因时因为调用<code>register_handler()</code>的时机不对，
还没有调用<code>connect()</code>，就调用了<code>register_handler()</code>，
这个时候要注册的句柄因为没有建立连接，值还是-1，注册会失败，导致后续不能获得串口上的数据是理所当然的了。</p>

<p>总结一下Reactor中<code>register_handler()</code>/<code>remove_handler()</code>的调用顺序就是：</p>

<pre><code>connect()/accept()   -&gt;  register_handler()
remove_handler() -&gt; close()
</code></pre>

<p>附讨论的原始信息：</p>

<blockquote><p>Great news :)  Also, don&#8217;t forget to do the reverse when cleaning up:  Call remove_handler() *before* closing the port or you&#8217;ll see a fault on shutdown.  Basically, the sequence is &#8220;connect port -> register_handler() -> (do serial stuff) -> remove_handler() -> close port&#8221;.  Finally, don&#8217;t try this on Win32 platforms :)</p><p>- Bob</p><p><br/> &#8212;&#8212;<br/>Hi Bob,</p><p>that´s the error. When I&#8217;d started I had in the right order, but cause it wasn´t running (due to some further errors) I tried some things and totally forgot to change it back. Thank you so much^^.</p><p>Greetings,<br/>Daniel</p><p>@Andreas: I didn´t need to try your version.^^ But thx anyway&#8230;</p><p>&#8212;&#8212;&#8211; Original-Nachricht &#8212;&#8212;&#8211;<br/>> Datum: Fri, 6 Nov 2009 08:19:09 -0500<br/>> Von: robert.ciora@us.transport.bombardier.com<br/>> An: &#8220;Daniel Kempcke&#8221; <Daniel.Kempcke@gmx.net><br/>> CC: ace-users@list.isis.vanderbilt.edu, ace-users-bounces@list.isis.vanderbilt.edu<br/>> Betreff: Re: [ace-users] Problem reactor used with serial interface</p><p>> Daniel,<br/>><br/>> Another quick one:  You&#8217;re calling &#8220;reactor()->register_handler(&#8230;)&#8221;<br/>> before calling &#8220;connector->connect(&#8230;)&#8221;.  The register_handler() will use<br/>> your get_handle() to determine which handle to register.  Since you<br/>> haven&#8217;t connected the port yet, your get_handle() (which calls<br/>> peer_.get_handle()) is returning ACE_INVALID_HANDLE.  It&#8217;s in the<br/>> connect() call where the peer&#8217;s handle gets set to something valid.<br/>><br/>> Try calling register_handler() *after* calling connect().<br/>><br/>> - Bob<br/>><br/>><br/>><br/>> Please consider the environment before you print / Antes de imprimir,<br/>> piense en el medio ambiente<br/>><br/>> &#8220;Daniel Kempcke&#8221; <Daniel.Kempcke@gmx.net><br/>> Sent by: ace-users-bounces@list.isis.vanderbilt.edu<br/>> 11/06/2009 04:06 AM<br/>><br/>> To<br/>> ace-users@list.isis.vanderbilt.edu<br/>> cc<br/>><br/>> Subject<br/>> Re: [ace-users] Problem reactor used with serial interface<br/>><br/>><br/>> Hi Bob,<br/>><br/>> I tried it with -1 (and also with some other values). But the behaviour<br/>> didn&#8217;t change.<br/>> But anyway - thx for your response&#8230;<br/>><br/>> Daniel<br/>><br/>> &#8212;&#8212;&#8211; Original-Nachricht &#8212;&#8212;&#8211;<br/>> > Datum: Thu, 5 Nov 2009 10:41:30 -0500<br/>> > Von: robert.ciora@us.transport.bombardier.com<br/>> > An: &#8220;Daniel Kempcke&#8221; <Daniel.Kempcke@gmx.net><br/>> > CC: ace-users@list.isis.vanderbilt.edu,<br/>> ace-users-bounces@list.isis.vanderbilt.edu<br/>> > Betreff: Re: [ace-users] Problem reactor used with serial interface<br/>><br/>> > Daniel,<br/>> ><br/>> > As a quick guess: try setting your serial parameters&#8217; &#8220;readtimeoutmsec&#8221;<br/>> > field to -1.  This *should* cause the reactor (select() call) to<br/>> correctly<br/>> > block on the handle.<br/>> ><br/>> > - Bob<br/>> ><br/>> ><br/>> > Please consider the environment before you print / Antes de imprimir,<br/>> > piense en el medio ambiente<br/>> ><br/>> ><br/>> > &#8220;Daniel Kempcke&#8221; <Daniel.Kempcke@gmx.net><br/>> > Sent by: ace-users-bounces@list.isis.vanderbilt.edu<br/>> > 11/05/2009 10:21 AM<br/>> ><br/>> > To<br/>> > ace-users@list.isis.vanderbilt.edu<br/>> > cc<br/>> ><br/>> > Subject<br/>> > [ace-users] Problem reactor used with serial interface<br/>> ><br/>> > To: ace-bugs@cs.wustl.edu<br/>> > Subject: [area]: [synopsis]<br/>> ><br/>> >     ACE VERSION: 5.6.3<br/>> ><br/>> >     HOST MACHINE and OPERATING SYSTEM:<br/>> >     - Linux - Ubuntu 9.04 - Kernel 2.6.28<br/>> ><br/>> ><br/>> ><br/>> >     TARGET MACHINE and OPERATING SYSTEM, if different from HOST:<br/>> >     -<br/>> >     COMPILER NAME AND VERSION (AND PATCHLEVEL):<br/>> >     - g++ Version 4.3.3<br/>> ><br/>> ><br/>> >     BUILD METHOD USED:<br/>> > [Experimental ./configure or traditional makefile/project file?]<br/>> >     - makefile/project file<br/>> ><br/>> ><br/>> >     AREA/CLASS/EXAMPLE AFFECTED:<br/>> > [What example failed?  What module failed to compile?]<br/>> ><br/>> > Example for using the Reactor with a serial device and not with TCP/IP<br/>> as<br/>> > a data source. Compiling didn´t fail.<br/>> ><br/>> ><br/>> >     DOES THE PROBLEM AFFECT:<br/>> >         COMPILATION? -<br/>> >         LINKING? -<br/>> >             On Unix systems, did you run make realclean first?<br/>> >             - yes<br/>> >         EXECUTION?<br/>> >         - fails (no signal, caused by data input from the serial device,<br/>><br/>> > occurs)<br/>> ><br/>> ><br/>> >     DESCRIPTION:<br/>> ><br/>> >     The application uses the reactor. There is a serial device on which<br/>> > constantly data arrives. The applic just opens the serial connection and<br/>><br/>> > registers a handler to it. Then it starts the run_reactor_event_loop -<br/>> in<br/>> > this case without an exit conditions.<br/>> ><br/>> ><br/>> > The application uses the standard reactor methods:<br/>> ><br/>> > The &#8220;open()&#8221; method registers a handler, makes a connect to the serial<br/>> > device and sets the serial parameters.<br/>> > The &#8220;handle_input()&#8221; method doesn´t have to do anythng special. In this<br/>> > example it shall only dislay the received data.<br/>> > &#8220;Handle_close()&#8221; just removes the handler, closes the serial connection<br/>> > and deletes the object.<br/>> ><br/>> ><br/>> > Normally I would expect, that the reactor would get signals - cause of<br/>> the<br/>> > incoming data on the serial interface - from the OS, which causes calls<br/>> of<br/>> > the &#8220;handle_input()&#8221; method.<br/>> > But nothing happens - the &#8220;handle_input()&#8221; routine&#8217;s never been called,<br/>> > despite there´s always data arriving on the serial interface.<br/>> ><br/>> > I tried also other examples, which were available online. They are<br/>> similar<br/>> > structured and also never reach the &#8220;handle_input()&#8221;.<br/>> ><br/>> ><br/>> > here´s the code example:<br/>> ><br/>> ><br/>> > #include &#8220;ace/DEV_Connector.h&#8221;<br/>> > #include &#8220;ace/TTY_IO.h&#8221;<br/>> > #include &#8220;ace/Time_Value.h&#8221;<br/>> > #include &#8220;ace/Reactor.h&#8221;<br/>> ><br/>> > #include <iostream><br/>> ><br/>> > class Service : public ACE_Event_Handler{<br/>> > public:<br/>> >                  Service();<br/>> >                  virtual ~Service();<br/>> ><br/>> >                  int open(const char *, ACE_TTY_IO::Serial_Params&<br/>> > sSerialParams);<br/>> ><br/>> >                  virtual ACE_HANDLE get_handle(void) const<br/>> >                  {<br/>> >                                  return this->peer_.get_handle();<br/>> >                  }<br/>> ><br/>> >                  virtual int handle_input(ACE_HANDLE fd =<br/>> > ACE_INVALID_HANDLE);<br/>> ><br/>> >                  virtual int handle_close(ACE_HANDLE handle,<br/>> > ACE_Reactor_Mask close_mask);<br/>> ><br/>> > protected:<br/>> >                  ACE_DEV_Connector connector_;<br/>> >                  //ACE_Message_Queue<ACE_NULL_SYNC> output_queue;<br/>> ><br/>> > private:<br/>> >                  ACE_TTY_IO peer_;<br/>> > };<br/>> ><br/>> ><br/>> > int open(const char* name, ACE_TTY_IO::Serial_Params& sSerialParams) {<br/>> ><br/>> >                  int nResult = 0;<br/>> ><br/>> >                  ACE_Reactor::instance()->register_handler(this,<br/>> >  ACE_Event_Handler::READ_MASK);<br/>> > // Set our I/O handle to that of the peer_ object handling our<br/>> connection<br/>> > if (this->connector_.connect(peer_, ACE_DEV_Addr(name), 0,<br/>> >                                                  ACE_Addr::sap_any, 0,<br/>> > //reuse<br/>> >                                                  O_RDWR |<br/>> > FILE_FLAG_OVERLAPPED) != 0) {<br/>> >                                  ACE_ERROR((LM_ERROR, ACE_TEXT(&#8220;%p\n&#8221;),<br/>> >                  ACE_TEXT(&#8220;&#8212; SerialIOHandler connect\n&#8221;)));<br/>> >                                  nResult = -1;<br/>> >                  }<br/>> ><br/>> >                  if (peer_.control(ACE_TTY_IO::SETPARAMS,<br/>> &sSerialParams)<br/>> > != 0) {<br/>> >                                  ACE_ERROR((LM_ERROR, ACE_TEXT(&#8220;%p<br/>> > control\n&#8221;), name));<br/>> >                                  nResult = -1;<br/>> >                  }<br/>> ><br/>> ><br/>> >                  return nResult;<br/>> > }<br/>> ><br/>> > int handle_input(ACE_HANDLE) {<br/>> >                  char *readBack;<br/>> >                  peer_.recv((void *) &readBack, 1);<br/>> ><br/>> >                  cout << readBack << endl;<br/>> ><br/>> >                  return 0;<br/>> > }<br/>> ><br/>> > int handle_close(ACE_HANDLE handle, ACE_Reactor_Mask close_mask) {<br/>> ><br/>> >                  if (this->peer_.get_handle() != ACE_INVALID_HANDLE) {<br/>> >                                  ACE_Reactor_Mask m =<br/>> > ACE_Event_Handler::ACCEPT_MASK<br/>> >                                                                  |<br/>> > ACE_Event_Handler::DONT_CALL;<br/>> ><br/>> >                                  this->reactor()->remove_handler(this,<br/>> m);<br/>> >                                  this->peer_.close();<br/>> ><br/>> >                                  delete this;<br/>> >                                  return 0;<br/>> >                  }<br/>> >                  return 0;<br/>> > }<br/>> ><br/>> ><br/>> > int ACE_TMAIN(int, ACE_TCHAR *[]) {<br/>> ><br/>> >                  Service SerialIO0;<br/>> >                  Service SerialIO1;<br/>> ><br/>> >                  ACE_TTY_IO::Serial_Params sSerialParams;<br/>> >            sSerialPortParams.baudrate = 115200;<br/>> >                     sSerialPortParams.xonlim = 0;<br/>> >                     sSerialPortParams.xofflim = 0;<br/>> >                     sSerialPortParams.readmincharacters = 0;<br/>> >                     sSerialPortParams.readtimeoutmsec = 1000; // 1<br/>> second<br/>> >                     sSerialPortParams.paritymode = &#8220;none&#8221;;<br/>> >                     sSerialPortParams.ctsenb = false;<br/>> >                     sSerialPortParams.rtsenb = 0;<br/>> >                     sSerialPortParams.xinenb = false;<br/>> >                     sSerialPortParams.xoutenb = false;<br/>> >                     sSerialPortParams.modem = false;<br/>> >                     sSerialPortParams.rcvenb = true;<br/>> >                     sSerialPortParams.dsrenb = false;<br/>> >                     sSerialPortParams.dtrdisable = false;<br/>> >                     sSerialPortParams.databits = 8;<br/>> >                     sSerialPortParams.stopbits = 1;<br/>> ><br/>> ><br/>> >                  const char * serName0 = &#8220;/dev/ttyUSB0&#8221;;<br/>> >                  const char * serName1 = &#8220;/dev/ttyUSB1&#8221;;<br/>> ><br/>> ><br/>> >                  if (SerialIO0.open(serName0, sSerialParams) == -1)<br/>> >                  {<br/>> >                                  cout << "could not connect to: " <<<br/>> > serName0 << endl;<br/>> >                                  return 1;<br/>> >                  }<br/>> ><br/>> >                  if (SerialIO1.open(serName1, sSerialParams) == -1)<br/>> >                  {<br/>> >                                  cout << "could not connect to: " <<<br/>> > serName1 << endl;<br/>> >                                  return 1;<br/>> >                  }<br/>> ><br/>> >                  cout << "connected to: " << serName0 << " " << serName1<br/>><br/>> > << endl;<br/>> ><br/>> ><br/>> >                  ACE_Reactor::instance()->run_reactor_event_loop();<br/>> ><br/>> >                  return 0;<br/>> > }<br/>> ><br/>> > Would be great if somebody could give me a little help. Thanks a lot in<br/>> > advance.<br/>> > Best regards,<br/>> > Daniel<br/>> ></p></blockquote>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/05/05/how-to-setup-rhel-kdump/">How to Setup RHEL Kdump</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-05-05T22:39:00+08:00" pubdate data-updated="true">May 5<span>th</span>, 2009</time>
        
         | <a href="/blog/2009/05/05/how-to-setup-rhel-kdump/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><code>Kdump</code>是一种调试Linux内核的方法，
用于在Linux内核出现<code>Oops</code>之后自动dump内核映像到指定位置的机制，
便于我们的事后调试。</p>

<blockquote><p>Kdump is a new kernel crash dumping mechanism and is very reliable.<br/>The crash dump is captured from the context of a freshly booted kernel<br/>and not from the context of the crashed kernel.<br/>Kdump uses kexec to boot into a second kernel whenever the system crashes.<br/>This second kernel, often called a capture kernel, boots with very little<br/>memory and captures the dump image.</p></blockquote>


<ol>
<li>Install <code>kexec-tools</code></li>
</ol>


<p>Install by <code>yum</code>:</p>

<pre><code>yum install kexec-tools
</code></pre>

<ol>
<li>write kdump config file <code>/etc/kdump.conf</code></li>
</ol>


<p>An example with following content.</p>

<pre><code>path /var/crash
core_collector makedumpfile -d 31 -c
</code></pre>

<ol>
<li>change <code>/etc/grub.conf</code> append <code>crashkernel=128M@16M</code> to the end of kernel line.</li>
</ol>


<p>An example of <code>/etc/grub.conf</code></p>

<pre><code>default=0
timeout=5
splashimage=(hd0,0)/grub/splash.xpm.gz
hiddenmenu
title Red Hat Enterprise Linux Server (2.6.18-128.el5)
        root (hd0,0)
        kernel /vmlinuz-2.6.18-128.el5 ro root=/dev/mapper/luks-10d5d533-38f6-482c-982d-bfb488adfbed
 rhgb quiet crashkernel=128M@16M
        initrd /initrd-2.6.18-128.el5.img
</code></pre>

<ol>
<li>post config</li>
</ol>


<p>Set <code>kdump</code> service automatically start with system startup.</p>

<pre><code>chkconfig kdump on
service kdump start
reboot
</code></pre>

<p>After system reboot, the kdump is ready. the kernel crash file is located at <code>/var/crash/</code>.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/07/08/python-pip-virtualenv/">Python的virtualenv和pip</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/07/04/android-sparsearray/">Android上使用SparseArray来替代HashMap</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/29/install-octave-on-mac/">在Mac上安装octave</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/25/learn-git/">学习一点git</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/22/html5-resources/">学习一点HTML5</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/01/16/windows-phone-debug-message-output/">WP7中写调试消息</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/01/13/install-wp7-sdk-on-xp/">在XP下安装WP7的SDK</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/01/02/how-to-use-wp7-as-usb-drive/">How to use WP7 as USB drive</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/12/29/web-developer-tools-bookmark/">网站开发书签</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/12/28/jquery-revert-selection/">jQuery reverse selection</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Tag Cloud</h1>
    <span id="tag-cloud"><a href='/blog/categories/ace' style='font-size: 108.57142857142857%'>ace(2)</a> <a href='/blog/categories/agile' style='font-size: 104.28571428571429%'>agile(1)</a> <a href='/blog/categories/ai' style='font-size: 104.28571428571429%'>ai(1)</a> <a href='/blog/categories/algorithm' style='font-size: 112.85714285714286%'>algorithm(3)</a> <a href='/blog/categories/android' style='font-size: 104.28571428571429%'>android(1)</a> <a href='/blog/categories/apt' style='font-size: 104.28571428571429%'>apt(1)</a> <a href='/blog/categories/debian' style='font-size: 104.28571428571429%'>debian(1)</a> <a href='/blog/categories/debug' style='font-size: 117.14285714285714%'>debug(4)</a> <a href='/blog/categories/django' style='font-size: 104.28571428571429%'>django(1)</a> <a href='/blog/categories/drbd' style='font-size: 104.28571428571429%'>drbd(1)</a> <a href='/blog/categories/gdb' style='font-size: 104.28571428571429%'>gdb(1)</a> <a href='/blog/categories/git' style='font-size: 104.28571428571429%'>git(1)</a> <a href='/blog/categories/howto' style='font-size: 112.85714285714286%'>howto(3)</a> <a href='/blog/categories/hp-ux' style='font-size: 104.28571428571429%'>hp-ux(1)</a> <a href='/blog/categories/html5' style='font-size: 104.28571428571429%'>html5(1)</a> <a href='/blog/categories/http' style='font-size: 104.28571428571429%'>http(1)</a> <a href='/blog/categories/javascript' style='font-size: 112.85714285714286%'>javascript(3)</a> <a href='/blog/categories/jquery' style='font-size: 108.57142857142857%'>jquery(2)</a> <a href='/blog/categories/kernel' style='font-size: 125.71428571428572%'>kernel(6)</a> <a href='/blog/categories/linux' style='font-size: 160.0%'>linux(14)</a> <a href='/blog/categories/nettl' style='font-size: 104.28571428571429%'>nettl(1)</a> <a href='/blog/categories/ntp' style='font-size: 104.28571428571429%'>ntp(1)</a> <a href='/blog/categories/octave' style='font-size: 104.28571428571429%'>octave(1)</a> <a href='/blog/categories/pip' style='font-size: 104.28571428571429%'>pip(1)</a> <a href='/blog/categories/putty' style='font-size: 104.28571428571429%'>putty(1)</a> <a href='/blog/categories/python' style='font-size: 108.57142857142857%'>python(2)</a> <a href='/blog/categories/scrum' style='font-size: 104.28571428571429%'>scrum(1)</a> <a href='/blog/categories/secure' style='font-size: 104.28571428571429%'>secure(1)</a> <a href='/blog/categories/shell' style='font-size: 104.28571428571429%'>shell(1)</a> <a href='/blog/categories/virtualenv' style='font-size: 104.28571428571429%'>virtualenv(1)</a> <a href='/blog/categories/web' style='font-size: 108.57142857142857%'>web(2)</a> <a href='/blog/categories/windbg' style='font-size: 104.28571428571429%'>windbg(1)</a> <a href='/blog/categories/wp7' style='font-size: 112.85714285714286%'>wp7(3)</a> </span>
</section>

<section>
  <h1>新浪微博</h1>
  <ul id="weibo">
    <li>
      <iframe 
        width="100%" 
        height="550" 
        class="share_self" 
        frameborder="0" 
        scrolling="no" 
        src="http://widget.weibo.com/weiboshow/index.php?width=0&height=550&ptype=1&speed=0&skin=&isTitle=0&noborder=1&isWeibo=1&isFans=&uid=2036163762&verifier=bce5fd03">
      </iframe>
    </li>
  </ul>
</section>







  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Ming -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'chenming';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
